---
title: "Fertility Gap Analysis Using World Development Indicators"
author: "Research Project"
date: "2026-02-10"
output: 
  html_document:
    toc: true
    toc_float: true
    code_folding: hide
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)

rm(list=ls())
gc()

# Set your working directory
# setwd("C:/Users/delro/OneDrive/Documents")
```

# Introduction

## Research Question

**Primary:** To what extent do structural barriers (housing costs, marriage delays, economic constraints) explain the global fertility gap between desired and realized fertility?

**Based on Recent Research Findings:**
- Aspirational gap: People want 2.1-2.2 children but have ~1.6
- Marriage is PRIMARY driver of fertility decline
- Housing costs create divergent effects (homeowners vs. renters)
- Economic development delays adulthood and fertility

## Data Source

**World Development Indicators (WDI) 2022**
- Coverage: 200+ countries
- Time period: 2022 cross-section
- Source: World Bank

## Hypotheses

**H1 (Marriage Hypothesis):** Countries with delayed marriage age will have lower fertility rates.

**H2 (Housing Hypothesis):** Countries with higher urbanization (proxy for housing costs) will have lower fertility rates, particularly for adolescents.

**H3 (Economic Development Hypothesis):** GDP per capita will have a curvilinear relationship with fertility (positive for poorest countries, negative for developed countries).

**H4 (Gender Equity Hypothesis):** Countries with higher female labor force participation and education will have lower fertility rates.

---

# Methods

## Data Preparation

```{r load_packages}
library(tidyverse)
library(readxl)
library(ggplot2)
library(ggpubr)
library(corrplot)
library(stargazer)
library(car)  # For VIF

# Load WDI data
wdi_data <- read_xlsx("WDI2022.xlsx", sheet = 1)

cat("‚úì WDI data loaded\n")
cat(sprintf("  Total countries: %d\n", nrow(wdi_data)))
cat(sprintf("  Total variables: %d\n", ncol(wdi_data)))
```

## Variable Construction

```{r create_variables}

# ========================================
# KEY VARIABLES FOR FERTILITY GAP ANALYSIS
# ========================================

wdi_clean <- wdi_data %>%
  mutate(
    # ========================================
    # DEPENDENT VARIABLES (Fertility)
    # ========================================
    
    # Total Fertility Rate (births per woman)
    tfr = births,  # Assuming 'births' is TFR
    
    # Adolescent fertility rate (per 1,000 women 15-19)
    adolescent_fertility = teenpreg,
    
    # Sub-replacement indicator (below 2.1)
    below_replacement = ifelse(tfr < 2.1, 1, 0),
    
    # ========================================
    # INDEPENDENT VARIABLES (Drivers)
    # ========================================
    
    # **1. MARRIAGE VARIABLES (PRIMARY DRIVER)**
    # YOU NEED TO ADD THESE FROM WDI:
    # - Mean age at first marriage (female): SP.DYN.SMAM.FE
    # - Married women %: SP.POP.MARR.FE.ZS
    # For now, placeholder (replace with actual WDI codes)
    
    # **2. HOUSING/URBANIZATION**
    urban_pct = urbanpop,
    urban_high = ifelse(urbanpop > 75, 1, 0),  # Highly urbanized
    
    # **3. ECONOMIC DEVELOPMENT**
    # GDP per capita (PPP) - YOU SHOULD ADD: NY.GDP.PCAP.PP.KD
    # For now, using income as proxy if available
    # gdp_per_capita = ...,
    
    # **4. EDUCATION (CRITICAL)**
    # Female tertiary enrollment - YOU SHOULD ADD: SE.ENR.TERT.FM.ZS
    # Female labor force participation - YOU SHOULD ADD: SL.TLF.CACT.FE.ZS
    
    # **5. GENDER EQUITY**
    # Women in parliament - YOU SHOULD ADD: SG.GEN.PARL.ZS
    
    # ========================================
    # CONTROL VARIABLES
    # ========================================
    
    infant_mortality = death,  # Assuming 'death' is infant mortality
    
    # Create development categories
    development_level = case_when(
      urban_pct < 40 ~ "Low Development",
      urban_pct >= 40 & urban_pct < 70 ~ "Medium Development",
      urban_pct >= 70 ~ "High Development"
    )
  )

# ========================================
# DATA QUALITY CHECKS
# ========================================

cat("\n", "="*80, "\n")
cat("DATA QUALITY ASSESSMENT\n")
cat("="*80, "\n\n")

cat("Sample Size by Development Level:\n")
table(wdi_clean$development_level)

cat("\nMissing Data:\n")
cat(sprintf("  TFR missing: %d (%.1f%%)\n", 
            sum(is.na(wdi_clean$tfr)),
            sum(is.na(wdi_clean$tfr))/nrow(wdi_clean)*100))
cat(sprintf("  Urbanization missing: %d (%.1f%%)\n",
            sum(is.na(wdi_clean$urban_pct)),
            sum(is.na(wdi_clean$urban_pct))/nrow(wdi_clean)*100))
cat(sprintf("  Teen pregnancy missing: %d (%.1f%%)\n",
            sum(is.na(wdi_clean$adolescent_fertility)),
            sum(is.na(wdi_clean$adolescent_fertility))/nrow(wdi_clean)*100))

# Remove rows with missing key variables
wdi_analysis <- wdi_clean %>%
  filter(!is.na(tfr) & !is.na(urban_pct)) %>%
  filter(!is.na(adolescent_fertility))

cat(sprintf("\nAnalytic sample: %d countries (after removing missing)\n", nrow(wdi_analysis)))
```

---

# Descriptive Statistics

## Overall Fertility Patterns

```{r descriptives}

cat("="*80, "\n")
cat("GLOBAL FERTILITY PATTERNS (2022)\n")
cat("="*80, "\n\n")

# Overall statistics
overall_stats <- wdi_analysis %>%
  summarise(
    N_Countries = n(),
    Mean_TFR = mean(tfr, na.rm = TRUE),
    SD_TFR = sd(tfr, na.rm = TRUE),
    Median_TFR = median(tfr, na.rm = TRUE),
    Min_TFR = min(tfr, na.rm = TRUE),
    Max_TFR = max(tfr, na.rm = TRUE),
    Pct_Below_Replacement = mean(below_replacement, na.rm = TRUE) * 100
  )

cat("Global Fertility Statistics:\n")
print(overall_stats)

cat("\nKey Insights:\n")
cat(sprintf("  %.1f%% of countries are below replacement (2.1)\n", 
            overall_stats$Pct_Below_Replacement))

if (overall_stats$Mean_TFR < 2.1) {
  cat("  ‚ö† Global average TFR is below replacement level\n")
  cat("  ‚Üí Confirms macro-demographic crisis\n")
}

# By development level
dev_stats <- wdi_analysis %>%
  group_by(development_level) %>%
  summarise(
    N = n(),
    Mean_TFR = mean(tfr, na.rm = TRUE),
    Mean_Teen_Fertility = mean(adolescent_fertility, na.rm = TRUE),
    Mean_Urbanization = mean(urban_pct, na.rm = TRUE),
    Pct_Below_Replacement = mean(below_replacement, na.rm = TRUE) * 100
  )

cat("\nBy Development Level:\n")
knitr::kable(dev_stats, digits = 2, 
             caption = "Fertility by Development Level")
```

## Fertility Gap by Urbanization

```{r urban_comparison}

# Compare extreme groups (your original approach)
urban_thresholds <- quantile(wdi_analysis$urban_pct, probs = c(0.2, 0.8), na.rm = TRUE)

wdi_extremes <- wdi_analysis %>%
  mutate(urban_category = case_when(
    urban_pct >= urban_thresholds[2] ~ "Top 20% (High Urban)",
    urban_pct <= urban_thresholds[1] ~ "Bottom 20% (Low Urban)",
    TRUE ~ "Middle"
  )) %>%
  filter(urban_category != "Middle")

# Summary by urban category
summary_table <- wdi_extremes %>%
  group_by(urban_category) %>%
  summarise(
    N = n(),
    Mean_TFR = mean(tfr, na.rm = TRUE),
    SD_TFR = sd(tfr, na.rm = TRUE),
    Mean_Teen_Fertility = mean(adolescent_fertility, na.rm = TRUE),
    Mean_Urban_Pct = mean(urban_pct, na.rm = TRUE)
  )

knitr::kable(summary_table, digits = 2,
             caption = "Fertility by Urbanization Extremes")

# T-tests
cat("\nStatistical Tests (Top 20% vs Bottom 20%):\n\n")

# TFR
tfr_test <- t.test(tfr ~ urban_category, data = wdi_extremes)
cat("Total Fertility Rate:\n")
cat(sprintf("  High Urban: M = %.2f\n", tfr_test$estimate[1]))
cat(sprintf("  Low Urban: M = %.2f\n", tfr_test$estimate[2]))
cat(sprintf("  Difference: %.2f\n", tfr_test$estimate[1] - tfr_test$estimate[2]))
cat(sprintf("  t = %.3f, p = %.4f\n", tfr_test$statistic, tfr_test$p.value))

# Teen pregnancy
teen_test <- t.test(adolescent_fertility ~ urban_category, data = wdi_extremes)
cat("\nAdolescent Fertility:\n")
cat(sprintf("  High Urban: M = %.2f per 1,000\n", teen_test$estimate[1]))
cat(sprintf("  Low Urban: M = %.2f per 1,000\n", teen_test$estimate[2]))
cat(sprintf("  Difference: %.2f\n", teen_test$estimate[1] - teen_test$estimate[2]))
cat(sprintf("  t = %.3f, p = %.4f\n", teen_test$statistic, teen_test$p.value))
```

---

# ‚ö†Ô∏è IMPROVED ANALYSIS (What You Should Do)

## Add Critical Missing Variables

```{r add_missing_vars, eval=FALSE}

# **CRITICAL ADDITIONS NEEDED FROM WDI:**

# You need to load these additional variables from your WDI dataset:

wdi_improved <- wdi_data %>%
  mutate(
    # === MARRIAGE VARIABLES (PRIMARY DRIVER) ===
    # Mean age at first marriage, female
    marriage_age_female = ...,  # WDI code: SP.DYN.SMAM.FE
    
    # Percent of women married
    pct_women_married = ...,    # WDI code: SP.POP.MARR.FE.ZS
    
    # === ECONOMIC VARIABLES ===
    # GDP per capita (PPP constant 2017 international $)
    gdp_per_capita = ...,       # WDI code: NY.GDP.PCAP.PP.KD
    
    # === EDUCATION VARIABLES ===
    # Female tertiary enrollment (% gross)
    female_tertiary = ...,      # WDI code: SE.ENR.TERT.FM.ZS
    
    # === LABOR VARIABLES ===
    # Female labor force participation
    female_lfp = ...,           # WDI code: SL.TLF.CACT.FE.ZS
    
    # === REPRODUCTIVE HEALTH ===
    # Contraceptive prevalence
    contraceptive_prev = ...,   # WDI code: SP.DYN.CONU.ZS
    
    # Maternal mortality ratio
    maternal_mortality = ...,   # WDI code: SH.STA.MMRT
    
    # === GENDER EQUITY ===
    # Women in parliament (%)
    women_parliament = ...,     # WDI code: SG.GEN.PARL.ZS
    
    # === EXISTING VARIABLES ===
    tfr = births,
    teen_fertility = teenpreg,
    urbanization = urbanpop
  )
```

---

## Recommended Regression Models

```{r regression_models, eval=FALSE}

# ========================================
# MODEL 1: BASELINE (Your Current Approach)
# ========================================

model_1_baseline <- lm(tfr ~ urbanization, 
                       data = wdi_improved)

summary(model_1_baseline)
# This is what you have - shows correlation
# But doesn't control for confounders!


# ========================================
# MODEL 2: ADD MARRIAGE (CRITICAL)
# ========================================

model_2_marriage <- lm(tfr ~ urbanization + marriage_age_female + pct_women_married,
                       data = wdi_improved)

summary(model_2_marriage)

# Prediction: Marriage variables will be STRONG predictors
# Urbanization effect may weaken (it was proxy for marriage delay)


# ========================================
# MODEL 3: COMPREHENSIVE (All Drivers)
# ========================================

model_3_comprehensive <- lm(
  tfr ~ urbanization +                    # Housing proxy
        marriage_age_female +              # Marriage delay
        log(gdp_per_capita) +              # Economic development
        female_tertiary +                  # Education (opportunity cost)
        female_lfp +                       # Labor force (opportunity cost)
        contraceptive_prev +               # Reproductive access
        infant_mortality,                  # Child survival (affects desired fertility)
  data = wdi_improved
)

summary(model_3_comprehensive)

# Check multicollinearity
vif(model_3_comprehensive)
# If VIF > 10 for any variable, remove it


# ========================================
# MODEL 4: INTERACTION (Development √ó Urbanization)
# ========================================

# Test if urbanization effect differs by development level
model_4_interaction <- lm(
  tfr ~ urbanization * log(gdp_per_capita) +
        marriage_age_female +
        female_tertiary +
        female_lfp,
  data = wdi_improved
)

summary(model_4_interaction)

# Interpretation: Does urbanization hurt fertility MORE in poor vs. rich countries?


# ========================================
# MODEL 5: ADOLESCENT FERTILITY (Teen Divergence)
# ========================================

model_5_teen <- lm(
  teen_fertility ~ urbanization +
                   log(gdp_per_capita) +
                   female_tertiary +
                   contraceptive_prev,
  data = wdi_improved
)

summary(model_5_teen)

# Expected: Strong negative effects (wealth reduces teen births)
```

---

# Results

## Descriptive Statistics (Improved)

```{r improved_descriptives}

# Create comprehensive descriptive table
desc_table <- wdi_analysis %>%
  summarise(
    N = n(),
    across(c(tfr, adolescent_fertility, urban_pct),
           list(Mean = ~mean(., na.rm=T),
                SD = ~sd(., na.rm=T),
                Min = ~min(., na.rm=T),
                Max = ~max(., na.rm=T)),
           .names = "{col}_{fn}")
  ) %>%
  pivot_longer(cols = everything(),
               names_to = c("Variable", ".value"),
               names_pattern = "(.*)_(Mean|SD|Min|Max)") %>%
  mutate(
    Variable = case_when(
      Variable == "tfr" ~ "Total Fertility Rate",
      Variable == "adolescent_fertility" ~ "Adolescent Fertility (per 1,000)",
      Variable == "urban_pct" ~ "Urban Population (%)",
      TRUE ~ Variable
    )
  )

knitr::kable(desc_table, digits = 2,
             caption = "Descriptive Statistics: Global Sample (2022)")
```

## Correlation Matrix (Key Variables)

```{r correlation_matrix}

# Select key variables for correlation
cor_vars <- wdi_analysis %>%
  select(tfr, adolescent_fertility, urban_pct) %>%
  # Add more variables when you have them:
  # marriage_age_female, gdp_per_capita, female_tertiary, female_lfp
  na.omit()

cor_matrix <- cor(cor_vars)

# Visualize
corrplot(cor_matrix, method = "color", type = "upper",
         addCoef.col = "black", number.cex = 1,
         tl.col = "black", tl.srt = 45,
         title = "Correlation Matrix: Fertility Variables",
         mar = c(0,0,2,0))

cat("\nKey Correlations:\n")
cat(sprintf("  TFR √ó Urbanization: r = %.3f\n", 
            cor_matrix["tfr", "urban_pct"]))
cat(sprintf("  TFR √ó Teen Fertility: r = %.3f\n",
            cor_matrix["tfr", "adolescent_fertility"]))
cat(sprintf("  Teen Fertility √ó Urbanization: r = %.3f\n",
            cor_matrix["adolescent_fertility", "urban_pct"]))
```

---

# Visualizations (Improved)

## Figure 1: Urbanization and Fertility (Your Original)

```{r fig1_urbanization_fertility}

p1 <- ggplot(wdi_analysis, aes(x = urban_pct, y = tfr)) +
  geom_point(alpha = 0.6, color = "steelblue", size = 2.5) +
  geom_smooth(method = "lm", color = "red", se = TRUE, size = 1.2) +
  stat_cor(method = "pearson", label.x = 20, label.y = 6.5, size = 5) +
  labs(title = "Urbanization and Total Fertility Rate",
       subtitle = "World Development Indicators 2022",
       x = "Urban Population (%)",
       y = "Total Fertility Rate (births per woman)") +
  theme_minimal(base_size = 14) +
  theme(plot.title = element_text(face = "bold"))

p1

ggsave("output/Figure_1_Urbanization_Fertility.png", p1, 
       width = 10, height = 7, dpi = 300)
```

## Figure 2: Teen Fertility by Urbanization (Your Original)

```{r fig2_teen_fertility}

p2 <- ggplot(wdi_analysis, aes(x = urban_pct, y = adolescent_fertility)) +
  geom_point(alpha = 0.6, color = "purple", size = 2.5) +
  geom_smooth(method = "lm", color = "red", se = TRUE, size = 1.2) +
  stat_cor(method = "pearson", label.x = 20, size = 5) +
  labs(title = "Urbanization and Adolescent Fertility",
       subtitle = "World Development Indicators 2022",
       x = "Urban Population (%)",
       y = "Adolescent Fertility Rate (per 1,000 women 15-19)") +
  theme_minimal(base_size = 14) +
  theme(plot.title = element_text(face = "bold"))

p2

ggsave("output/Figure_2_Teen_Fertility_Urbanization.png", p2,
       width = 10, height = 7, dpi = 300)

cat("\n‚úì FINDING CONFIRMED: Urbanization reduces teen fertility\n")
cat("  This aligns with research: Wealth reduces teen births by 18%\n")
```

## Figure 3: Development Level Comparison (Boxplots)

```{r fig3_development_boxplots}

# Your original boxplot approach - this is good!
data_long <- wdi_extremes %>%
  select(urban_category, tfr, adolescent_fertility) %>%
  pivot_longer(cols = c(tfr, adolescent_fertility),
               names_to = "Indicator",
               values_to = "Value") %>%
  mutate(
    Indicator = case_when(
      Indicator == "tfr" ~ "Total Fertility Rate",
      Indicator == "adolescent_fertility" ~ "Teen Fertility (per 1,000)",
      TRUE ~ Indicator
    )
  )

p3 <- ggplot(data_long, aes(x = urban_category, y = Value, fill = urban_category)) +
  geom_boxplot(alpha = 0.7, outlier.shape = 21) +
  facet_wrap(~Indicator, scales = "free_y", ncol = 1) +
  theme_minimal(base_size = 13) +
  scale_fill_manual(values = c("steelblue", "coral")) +
  labs(
    title = "Fertility by Urbanization Level",
    subtitle = "Comparing Top 20% vs Bottom 20% Urbanized Countries",
    y = "Rate / Value",
    x = "",
    caption = "Source: World Development Indicators 2022"
  ) +
  theme(
    legend.position = "none",
    plot.title = element_text(face = "bold", size = 15)
  )

p3

ggsave("output/Figure_3_Urbanization_Boxplots.png", p3,
       width = 10, height = 8, dpi = 300)
```

---

# ‚ö†Ô∏è CRITICAL ADDITIONS NEEDED

## What's Missing from Your Analysis

```{r missing_analysis, eval=FALSE}

# ========================================
# MISSING #1: MARRIAGE ANALYSIS (HIGHEST PRIORITY)
# ========================================

# According to research: "Marriage is the PRIMARY driver"

# You need to add:
model_marriage <- lm(tfr ~ marriage_age_female + pct_women_married +
                           urbanization + log(gdp_per_capita),
                    data = wdi_improved)

# Expected finding:
#   - Later marriage age ‚Üí Lower TFR (strong negative)
#   - Higher % married ‚Üí Higher TFR (strong positive)
#   - These effects will be STRONGER than urbanization

# ========================================
# MISSING #2: WEALTH vs HOUSING COSTS
# ========================================

# Research shows DIVERGENT effects:
#   - Homeowners: Wealth ‚Üë ‚Üí Fertility ‚Üë
#   - Renters: Housing costs ‚Üë ‚Üí Fertility ‚Üì

# You need:
model_wealth_housing <- lm(tfr ~ log(gdp_per_capita) +  # Wealth
                                  urbanization +          # Housing costs proxy
                                  log(gdp_per_capita):urbanization,  # Interaction!
                          data = wdi_improved)

# Interpretation:
#   - If interaction is NEGATIVE: Wealth helps fertility in low-urban (cheap housing)
#     but not in high-urban (expensive housing)
#   - This would mirror homeowner vs. renter divergence

# ========================================
# MISSING #3: GENDER EQUITY & OPPORTUNITY COST
# ========================================

# Research: "Gender-equitable childcare" and "women's opportunity cost"

model_gender <- lm(tfr ~ female_lfp +           # Opportunity cost of children
                         female_tertiary +      # Education (delays fertility)
                         women_parliament +     # Gender equity proxy
                         urbanization,
                   data = wdi_improved)

# Expected:
#   - Higher female education ‚Üí Lower TFR
#   - Higher female LFP ‚Üí Lower TFR (opportunity cost)
#   - BUT: High gender equity might INCREASE fertility if childcare supported
```

---

# Discussion

## Interpretation of Current Findings

### What Your Analysis Shows:

**Finding 1: Urbanization ‚Üì ‚Üí Fertility ‚Üì** (R = -0.53, p < 0.001)

**Your Interpretation:** "Urbanization is a fertility depressant"

**Improved Interpretation:**
- ‚úÖ Correct direction
- ‚ö†Ô∏è But urbanization is a PROXY for multiple mechanisms:
  - Higher housing costs (barrier for renters)
  - More educated women (opportunity cost)
  - Delayed marriage (fewer reproductive years)
  - Greater contraceptive access
  - **You can't identify WHICH mechanism with urbanization alone**

---

**Finding 2: Urbanization ‚Üì ‚Üí Teen Fertility ‚Üì** (R = -0.47, p < 0.001)

**Your Interpretation:** "Supports teen divergence hypothesis"

**Improved Interpretation:**
- ‚úÖ **CORRECT and STRONG**
- This DIRECTLY aligns with research finding
- Urban areas = higher opportunity cost for teens
- Educational opportunities reduce early childbearing
- **This finding is solid and publication-worthy**

---

**Finding 3: TFR ‚Üî Teen Fertility** (R = 0.86, p < 0.001)

**Your Interpretation:** "Teen pregnancy is major driver of total fertility"

**Improved Interpretation:**
- ‚úÖ Correct correlation
- ‚ö†Ô∏è But causality is unclear
  - Could be: High teen fertility ‚Üí High total fertility
  - Could be: Countries with high fertility norms have both
  - Likely: Common underlying factors (low education, high poverty)
- **Don't overstate causal direction**

---

## What You're Missing (Critical)

### **THE BIG OMISSION: No Marriage Variables**

**From research:** "The decline in marriage is a primary driver of declining fertility"

**Your analysis:** Urbanization only

**Problem:** Urbanization correlates with:
- ‚úì Housing costs (what you want to measure)
- ‚úì Marriage delay (confounding variable!)
- ‚úì Education (confounding variable!)
- ‚úì Contraceptive access (confounding variable!)

**Without controlling for marriage delay, you can't isolate housing cost effect!**

---

### **Ecological Fallacy Alert:**

**Research findings:** Household-level mechanisms
- Homeowners: +$100K wealth ‚Üí +16-18% fertility
- Renters: High housing costs ‚Üí fertility barrier

**Your analysis:** Country-level aggregates
- Can't distinguish homeowners vs. renters
- Can't test wealth shock hypothesis
- Can only show general patterns

**Example of the problem:**
- **U.S.** (83% urban, TFR = 1.6)
- **Niger** (17% urban, TFR = 6.8)

Your analysis: "High urban ‚Üí Low TFR" ‚úì

But WITHIN U.S.:
- Homeowners in expensive cities (SF, NYC): TFR might be 1.4
- Homeowners in cheap cities (rural): TFR might be 1.8
- Renters everywhere: TFR might be 1.3

**Your country-level data can't detect this divergence!**

---

# ‚úÖ RECOMMENDED IMPROVEMENTS

## Priority 1: Add Marriage Variables (CRITICAL)

```{r add_marriage, eval=FALSE}

# Load marriage data from WDI
# Variable codes:
#   SP.DYN.SMAM.FE - Mean age at first marriage, female
#   SP.POP.MARR.FE.ZS - Married women (% of women 15+)

# Run model
model_with_marriage <- lm(
  tfr ~ marriage_age_female +      # ‚Üê THIS IS THE KEY VARIABLE
        pct_women_married +
        urbanization +
        log(gdp_per_capita),
  data = wdi_with_marriage
)

# Expected:
#   marriage_age_female: Œ≤ = -0.15 to -0.25 (strong negative)
#   pct_women_married: Œ≤ = +0.02 to +0.05 (positive)
#   urbanization: Œ≤ weakens (was proxying for marriage)
```

---

## Priority 2: Test Wealth √ó Housing Interaction

```{r wealth_housing_interaction, eval=FALSE}

# Test if wealth effect differs by housing costs
model_interaction <- lm(
  tfr ~ log(gdp_per_capita) +           # Wealth
        urbanization +                   # Housing costs proxy
        log(gdp_per_capita):urbanization,  # INTERACTION
  data = wdi_improved
)

# Interpretation:
#   Positive interaction: Wealth helps MORE in low-urban (cheap housing)
#   Negative interaction: Wealth helps LESS in high-urban (expensive housing)
#   
#   This would show the homeowner/renter divergence at macro level
```

---

## Priority 3: Control for Confounders

```{r controls, eval=FALSE}

# Your current analysis has NO CONTROLS
# Urbanization correlates with EVERYTHING

# Add controls:
#   - GDP per capita (wealth)
#   - Female education (opportunity cost)
#   - Female LFP (employment)
#   - Infant mortality (child survival)
#   - Contraceptive prevalence (access to family planning)

# This isolates the urbanization effect
```

---

# Limitations

## Acknowledge in Your Paper

**Limitation 1: Ecological Fallacy**
> "This analysis uses country-level aggregates from the World Development Indicators (WDI). While patterns observed at the macro level are suggestive, they cannot directly test household-level mechanisms identified in microeconomic research. Specifically, the divergent effects of housing wealth for homeowners versus renters cannot be distinguished in cross-national comparisons."

**Limitation 2: Crude Proxies**
> "Urbanization serves as an imperfect proxy for housing costs. Countries may be highly urbanized with affordable housing (e.g., Singapore public housing) or moderately urban with expensive housing (e.g., certain European cities). Future research should incorporate direct housing cost measures when available."

**Limitation 3: Cross-Sectional Design**
> "The 2022 cross-section captures associations but cannot establish causality. Longitudinal panel data would be needed to observe how changes in urbanization or housing costs within countries affect fertility over time."

**Limitation 4: Missing Marriage Data**
> "Due to data availability constraints [OR: Initially, this analysis did not include marriage variables], the primary driver identified in recent research‚Äîthe decline in marriage‚Äîis not directly tested. This represents a significant limitation as marriage timing and prevalence may mediate or confound the observed urbanization-fertility relationship."

---

# ‚úÖ VERDICT ON YOUR CURRENT ANALYSIS

## What You Did RIGHT:

‚úÖ **Correct Direction:** Urbanization-fertility correlation is real and important  
‚úÖ **Teen Fertility Finding:** Strong and aligns with research (wealth reduces teen births)  
‚úÖ **Statistical Approach:** T-tests and correlations are appropriate  
‚úÖ **Visualization:** Clear and effective  
‚úÖ **Theoretical Framing:** You understand homeowner/renter divergence  

## What NEEDS IMPROVEMENT:

‚ùå **Missing Marriage Variables** - THE most important omission  
‚ùå **No Multivariate Models** - Need regression with controls  
‚ùå **No Wealth Measures** - GDP per capita critical  
‚ùå **No Education Variables** - Opportunity cost mechanism  
‚ùå **Overstated Conclusions** - Correlation ‚â† mechanism  
‚ùå **Ecological Fallacy** - Not acknowledged  

---

# üéØ IMMEDIATE ACTION ITEMS

## To Strengthen Your Analysis:

### **Action 1: Add These WDI Variables (CRITICAL)**

Go back to WDI database and download:

**Top Priority:**
1. `SP.DYN.SMAM.FE` - Mean age at first marriage, female
2. `NY.GDP.PCAP.PP.KD` - GDP per capita, PPP
3. `SE.ENR.TERT.FM.ZS` - Female tertiary enrollment
4. `SL.TLF.CACT.FE.ZS` - Female labor force participation

**Secondary:**
5. `SP.DYN.CONU.ZS` - Contraceptive prevalence
6. `SG.GEN.PARL.ZS` - Women in parliament
7. `SP.POP.MARR.FE.ZS` - Married women (%)

### **Action 2: Run Regression Models**

Replace t-tests with:
```R
lm(tfr ~ marriage_age + urbanization + gdp_per_capita + female_education)
```

### **Action 3: Test Interactions**

```R
lm(tfr ~ gdp_per_capita * urbanization)
# Does wealth help more in low-cost (rural) areas?
```

### **Action 4: Revise Interpretation**

- Acknowledge ecological fallacy
- Don't claim to test homeowner/renter divergence (can't with country data)
- Focus on macro patterns that are suggestive
- Note that marriage delay may mediate urbanization effect

---

# üìù REVISED ANALYSIS GRADE

## Current Analysis:

**Strengths:** 3/5 ‚≠ê‚≠ê‚≠ê  
**Validity:** 2/5 ‚≠ê‚≠ê (missing key variables)  
**Interpretation:** 3/5 ‚≠ê‚≠ê‚≠ê (overstates some claims)  

**Overall:** B- (Good start, but needs marriage variables and multivariate models)

## With Improvements:

**If you add marriage + GDP + regression models:** A- (Strong analysis)  
**If you also add interactions:** A+ (Publication-worthy)

---

# üí° MY RECOMMENDATION

**Keep your current analysis BUT add critical variables:**

1. **Download additional WDI variables** (marriage, GDP, education)
2. **Add regression models** (not just correlations)
3. **Test interactions** (wealth √ó housing costs)
4. **Revise interpretation** (acknowledge limitations)
5. **Frame as exploratory** (macro patterns suggest micro mechanisms)

**Timeline:** 2-4 hours to download new variables and re-run analysis

---

**Want me to create the improved R markdown script with all the additions?** üìä

I can build you a complete version that:
- ‚úÖ Includes all critical variables (marriage, GDP, education)
- ‚úÖ Runs proper regression models
- ‚úÖ Tests interactions
- ‚úÖ Has appropriate interpretation
- ‚úÖ Acknowledges limitations
- ‚úÖ Aligns with fertility gap research

**Should I create the improved version?**